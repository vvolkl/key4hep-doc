

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spack Buildcaches &mdash; Key4HEP  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels.css" type="text/css" />
  <link rel="stylesheet" href="../_static/starterkit.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/panels.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using the Key4hep-Stack for CLIC Simulation and Reconstruction" href="../examples/clic.html" />
    <link rel="prev" title="Spack workflows for developing Key4HEP software" href="spack-developer-workflows.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Key4HEP
          

          
            
            <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../setup-and-getting-started/README.html">Getting started with Key4HEP software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../setup-and-getting-started/README.html#setting-up-the-key4hep-software-stack">Setting up the Key4HEP Software Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../setup-and-getting-started/README.html#using-central-installations-on-cvmfs">Using central installations on cvmfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../setup-and-getting-started/README.html#using-virtual-machines-or-docker-containers">Using Virtual Machines or Docker containers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup-and-getting-started/README.html#cernvm-virtual-appliance">CernVM Virtual Appliance</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="README.html">Using Spack to build Key4HEP software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="README.html#setting-up-spack">Setting up Spack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="README.html#downloading-a-pre-configured-instance-lxplus">Downloading a pre-configured instance (lxplus)</a></li>
<li class="toctree-l3"><a class="reference internal" href="README.html#configuring-spack">Configuring Spack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="README.html#installing-spack">Installing Spack</a></li>
<li class="toctree-l4"><a class="reference internal" href="README.html#installing-the-key4hep-package-recipes">Installing the key4hep package recipes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="README.html#configuring-packages-yaml">Configuring <code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="README.html#configuring-upstreams-yaml">Configuring <code class="docutils literal notranslate"><span class="pre">upstreams.yaml</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="README.html#setting-up-an-upstream-compiler">Setting up an upstream compiler</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spack-nightlies.html">Nightly Builds with Spack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spack-nightlies.html#usage-of-the-nightly-builds-on-cvmfs">Usage of the nightly builds on CVMFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-nightlies.html#technical-information">Technical Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spack-advanced.html">Spack Usage and Further Technical Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#concretizing-before-installation">Concretizing before Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spack-advanced.html#working-around-spack-concretizer-problems">Working around spack concretizer problems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack-advanced.html#requiring-a-specific-package-version">Requiring a specific package version</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack-advanced.html#requiring-certain-variants-globally">Requiring certain variants globally</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#system-dependencies">System Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#target-architectures">Target Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#bundle-packages-and-environments">Bundle Packages and Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#setting-up-runtime-environments">Setting Up Runtime Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#compiler-dependencies-and-data-packages">Compiler Dependencies and Data Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#duplicating-recipes-in-downstream-repositories">Duplicating Recipes in Downstream Repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#cvmfs-installation-workflow">CVMFS Installation Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#compiler-wrappers">Compiler Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#spack-installed-lcg-releases">Spack-Installed LCG releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack-advanced.html#using-spack-installed-gcc">Using Spack-installed GCC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spack-developer-workflows.html">Spack workflows for developing Key4HEP software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spack-developer-workflows.html#developing-a-single-package">Developing a single package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spack-developer-workflows.html#installing-a-local-version-with-dev-build">Installing a local version with <code class="docutils literal notranslate"><span class="pre">dev-build</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="spack-developer-workflows.html#using-the-local-version-as-dependency">Using the local version as dependency</a></li>
<li class="toctree-l3"><a class="reference internal" href="spack-developer-workflows.html#more-advanced-usage">More advanced usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spack-developer-workflows.html#developing-multiple-packages-or-dependencies-of-other-packages">Developing multiple packages or dependencies of other packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spack-developer-workflows.html#using-an-environment-to-setup-all-dependencies">Using an environment to setup all dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="spack-developer-workflows.html#environments-and-a-development-workflow">Environments and a development workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack-developer-workflows.html#adding-another-package-to-develop">Adding another package to develop</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Spack Buildcaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/clic.html">Using the Key4hep-Stack for CLIC Simulation and Reconstruction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/clic.html#simulation">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/clic.html#reconstruction">Reconstruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/clic.html#reconstruction-with-marlin">Reconstruction with Marlin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/clic.html#reconstruction-with-with-gaudi">Reconstruction with with Gaudi</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developing-key4hep-software/README.html">Developing Key4hep</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html">Github workflow and contribution guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#first-time-setup-of-git">First time setup of git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#generate-and-set-up-ssh-keys-for-github">Generate and set up ssh keys for github</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#improving-your-git-experience">Improving your git experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#development-workflow">Development workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#keeping-your-local-repository-up-to-date">Keeping your local repository up to date</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#contributing-code">Contributing code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#recommendations">Recommendations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#general-recommendations">General recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#commit-comments">Commit comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#cleaning-history">Cleaning history</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#pull-requests">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#trouble-shooting">Trouble-shooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#when-i-try-to-push-to-the-repository-i-get-an-authentication-error">When I try to push to the repository, I get an authentication error</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#i-have-cloned-with-https-and-now-i-can-t-push-my-changes-what-do-i-do">I have cloned with https and now I can’t push my changes, what do I do?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepSoftwareGit.html#need-help">Need help?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html">CMake guide for Key4hep software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#quick-start-into-building-key4hep-software">Quick start into building Key4hep Software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#set-up-the-environment">Set up the environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#running-cmake">Running CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#using-your-local-installation">Using your local installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#cmake-example-packages">CMake example packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#changing-the-cmake-configuration">Changing the CMake Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#runtime-environment">Runtime Environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#ctest-in-key4hep">CTest in Key4hep</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-key4hep-software/Key4hepCMakeGuide.html#customizing-how-cmake-is-run">Customizing how CMake is run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-key4hep-software/WritingAlgorithms.html">Writing Gaudi Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/WritingAlgorithms.html#getting-started">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-key4hep-software/WritingAlgorithms.html#exercise-adding-an-algorithm">Exercise: Adding an Algorithm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../talks-and-presentations/README.html">Talks and Presentations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../talks-and-presentations/README.html#upcoming-talks-and-workshops">Upcoming Talks and Workshops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../call-for-logos/README.html">Call for logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/fccsw">FCC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/CLIC/CLICSoftwareComputing">CLIC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ilcsoft.desy.de/portal">ILC software</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cepcsoft.ihep.ac.cn/">CEPC software</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Key4HEP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Spack Buildcaches</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/key4hep/key4hep-doc/blob/master/spack-build-instructions/spack-buildcache.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spack-buildcaches">
<h1>Spack Buildcaches<a class="headerlink" href="#spack-buildcaches" title="Permalink to this headline">¶</a></h1>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="spack-documentation"><i class="fa fa-info-circle"></i> Spack documentation</p>
</div>
<div class="panel-body docutils container">
<p>Buildcaches were investigated, but are no longer supported for Key4HEP software, due to the difficulty of relocating some packages.</p>
<p>For more information refer to the <a class="reference external" href="https://spack.readthedocs.io/en/latest/binary_caches.html">spack documentation</a>.</p>
</div>
</div>
<p>It is possible to relocate and  re-use  binaries with the so-called buildcache.
Some central buildcaches are on the key4hep <code class="docutils literal notranslate"><span class="pre">eos</span></code> space under:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/eos/project/k/key4hep/www/key4hep/spack_build/mirror/spackages
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">spackages</span></code> is intended as the central buildcache for key4hep packages built from scratch,
but there exist other buildcaches for packages built against the LCG releases, and rolling builds that are using the branchname <code class="docutils literal notranslate"><span class="pre">master</span></code> or other moving targets.
All packages versioned <code class="docutils literal notranslate"><span class="pre">package&#64;master</span></code> are treated by spack as the same version, even if master points to different commits, thus they must be installed to separate directories, ideally indicating the date.
A buildcache called <code class="docutils literal notranslate"><span class="pre">contrib</span></code> is intended for build tools such as compilers.
Spack automatically creates subdirectory for different platforms and compiler versions.</p>
<p>For write permissions to this space, subscribe to the egroup <code class="docutils literal notranslate"><span class="pre">cernbox-project-key4hep-writers</span></code>.</p>
<p>The following command can be used to put packages into the buildcache:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># key4hep-stack was already installed with &#39;spack install key4hep-stack&#39;</span>
spack mirror add key4hep /eos/project/k/key4hep/www/key4hep/spack_build/mirror/spackages
spack buildcache create -m key4hep -u -a -f key4hep-stack
</pre></div>
</div>
<p>Since the packages need to be relocated as well as copied, this might take up to an hour.</p>
<p>In order to install packages from the  buildcache, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack buildcache install -u -a key4hep-stack
</pre></div>
</div>
<p>Spack will then search all added mirrors for <code class="docutils literal notranslate"><span class="pre">key4hep-stack</span></code>.
For read-only access on machines without <code class="docutils literal notranslate"><span class="pre">eos</span></code>, these files are served also over http:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack mirror add key4hep-web http://key4hep.web.cern.ch/key4hep/spack_build/mirror/spackages/
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../examples/clic.html" class="btn btn-neutral float-right" title="Using the Key4hep-Stack for CLIC Simulation and Reconstruction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spack-developer-workflows.html" class="btn btn-neutral float-left" title="Spack workflows for developing Key4HEP software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Key4HEP

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>